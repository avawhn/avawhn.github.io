---
title: SQL优化常用点
tags:
---

加索引
避免索引失效
避免返回不必要的数据
减少不必要的逻辑
- 尽量用union all 替换 union 就是这种思想
分批量进行思想
- 更推荐批量插入
读写分离
- 主从库
优化SQL结构
- 尽量用小表驱动大表（EXISTS、IN的子查询顺序）
分库分表
- 依赖客户号、用户Id等
- 问题：事务问题、跨库关联JOIN、排序问题、分页问题、分布式ID选择
性能优化神器-explain
慢SQL排查过程
- 查看慢查询日志记录
- explain分析SQL执行计划
- profile分析执行耗时
- Optimizer Trace分析详情
- 确定问题并采用相应的措施


索引失效场景：

1. 隐式的类型转换，索引无效
2. 查询条件包含or，可能导致索引失效
3. like通配符可能导致索引失效
4. 最左匹配原则
5. 内置函数
6. 进行列运算
7. 不等于，索引可能失效
8. is null，is not null，索引可能失效
9. 左右连接，关联的字段编码格式不同
10. 优化器选错了索引